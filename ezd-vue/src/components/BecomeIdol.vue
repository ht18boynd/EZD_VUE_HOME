<template>
  <div>
    <!-- Start Header Section -->
    <startHeader></startHeader>
    <div class="cs-height_100 cs-height_lg_70"></div>

    <!-- Start Page Head -->
    <section class="cs-page_head cs-bg" data-src="assets/img/page_head_bg.svg">
      <div class="container">
        <div class="text-center">
          <h1 class="cs-page_title">Become The Idol</h1>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active">Form Register</li>
          </ol>
        </div>
      </div>
    </section>
    <!-- End Page Head -->
    <!-- <div class="cs-height_90 cs-height_lg_80"></div> -->
    <div class="cs-height_100 cs-height_lg_70"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 offset-lg-2">
          <div class="cs-contact_card_wrap">
            <div class="cs-contact_card">
              <div class="cs-contact_info text-center">
                <div class="cs-contact_icon">
                  <svg
                    width="39"
                    height="39"
                    viewBox="0 0 39 39"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0_1448_14685)">
                      <path
                        d="M16.7113 22.6393C20.4669 26.4044 24.8179 29.9986 26.5422 28.2759C29.0074 25.8059 30.5274 23.6637 35.9646 28.0305C41.4018 32.3974 37.2249 35.3107 34.8373 37.6984C32.0823 40.4534 21.8128 37.8424 11.6573 27.6917C1.50177 17.5409 -1.10439 7.26986 1.65061 4.51169C4.04461 2.12878 6.95002 -2.04172 11.3169 3.38594C15.6837 8.81361 13.5383 10.3368 11.0746 12.8004C9.35194 14.5326 12.9461 18.882 16.7113 22.6393Z"
                        fill="url(#paint0_linear_1448_14685)"
                      />
                    </g>
                    <defs>
                      <linearGradient
                        id="paint0_linear_1448_14685"
                        x1="38.6309"
                        y1="0.724609"
                        x2="-6.93527"
                        y2="23.7985"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop offset="0" stop-color="#FC466B" />
                        <stop offset="1" stop-color="#3F5EFB" />
                      </linearGradient>
                      <clipPath id="clip0_1448_14685">
                        <rect
                          width="38"
                          height="38"
                          fill="white"
                          transform="matrix(-1 0 0 1 38.623 0.726074)"
                        />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <h3 class="cs-contact_title">Phone</h3>
                <p class="cs-contact_text">0981578920</p>
              </div>
              <div class="cs-contact_info text-center">
                <div class="cs-contact_icon">
                  <svg
                    width="40"
                    height="39"
                    viewBox="0 0 40 39"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M35.8288 14.9442V29.2259C35.8288 30.9676 34.4038 32.3926 32.6621 32.3926H7.32878C5.58711 32.3926 4.16211 30.9676 4.16211 29.2259V10.2259C4.16211 8.48424 5.58711 7.05924 7.32878 7.05924H23.3204C23.2254 7.56591 23.1621 8.10424 23.1621 8.64258C23.1621 10.9859 24.1913 13.0601 25.8063 14.5167L19.9954 18.1426L7.32878 10.2259V13.3926L19.9954 21.3092L28.3871 16.0526C29.2421 16.3692 30.1288 16.5592 31.0788 16.5592C32.8679 16.5592 34.4988 15.9417 35.8288 14.9442ZM26.3288 8.64258C26.3288 11.2709 28.4504 13.3926 31.0788 13.3926C33.7071 13.3926 35.8288 11.2709 35.8288 8.64258C35.8288 6.01424 33.7071 3.89258 31.0788 3.89258C28.4504 3.89258 26.3288 6.01424 26.3288 8.64258Z"
                      fill="url(#paint0_linear_1448_14689)"
                    />
                    <defs>
                      <linearGradient
                        id="paint0_linear_1448_14689"
                        x1="4.16211"
                        y1="3.89258"
                        x2="40.3952"
                        y2="24.2752"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop offset="0" stop-color="#FC466B" />
                        <stop offset="1" stop-color="#3F5EFB" />
                      </linearGradient>
                    </defs>
                  </svg>
                </div>
                <h3 class="cs-contact_title">Email</h3>
                <p class="cs-contact_text">https://aptech.fpt.edu.vn</p>
              </div>
              <div class="cs-contact_info text-center">
                <div class="cs-contact_icon">
                  <svg
                    width="41"
                    height="39"
                    viewBox="0 0 41 39"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M20.5552 0.543945C29.1928 0.543945 36.1943 7.54547 36.1943 16.1831C36.1943 22.7916 31.5507 29.9937 22.3837 37.8662C21.874 38.304 21.2241 38.5445 20.5522 38.5439C19.8802 38.5434 19.2307 38.3017 18.7218 37.863L18.1155 37.3368C9.35433 29.6697 4.91602 22.6441 4.91602 16.1831C4.91602 7.54547 11.9175 0.543945 20.5552 0.543945ZM20.5552 10.168C18.9599 10.168 17.4299 10.8018 16.3019 11.9298C15.1738 13.0578 14.5401 14.5878 14.5401 16.1831C14.5401 17.7784 15.1738 19.3083 16.3019 20.4364C17.4299 21.5644 18.9599 22.1982 20.5552 22.1982C22.1505 22.1982 23.6804 21.5644 24.8085 20.4364C25.9365 19.3083 26.5702 17.7784 26.5702 16.1831C26.5702 14.5878 25.9365 13.0578 24.8085 11.9298C23.6804 10.8018 22.1505 10.168 20.5552 10.168Z"
                      fill="url(#paint0_linear_1448_14701)"
                    />
                    <defs>
                      <linearGradient
                        id="paint0_linear_1448_14701"
                        x1="4.91602"
                        y1="0.543945"
                        x2="45.0587"
                        y2="17.2727"
                        gradientUnits="userSpaceOnUse"
                      >
                        <stop offset="0" stop-color="#FC466B" />
                        <stop offset="1" stop-color="#3F5EFB" />
                      </linearGradient>
                    </defs>
                  </svg>
                </div>
                <h3 class="cs-contact_title">Suport FPT APTECH</h3>
                <p class="cs-contact_text">
                  590 Cách Mạng Tháng Tám, Phường 11, Quận 3, TP. HCM
                </p>
              </div>
            </div>
          </div>
          <div class="cs-height_50 cs-height_lg_50"></div>
          <div class="cs-contact_box">
            <div class="cs-section_heading cs-style4">
              <h2 class="cs-section_title">Đăng Ký Trở Thành Idol</h2>
              
            </div>
            <div class="cs-height_45 cs-height_lg_45"></div>
            <form class="cs-contact_form" @submit.prevent="createBecomeForm">
              <div class="row">
                <div class="col-lg-6">
                  <lable>Tên Đầy Đủ :</lable>
                  <div class="cs-form_field_wrap">
                  
                    <input
                      type="text"
                      class="cs-form_field"
                      v-model="fullName"
                      placeholder="Tên Đầy Đủ"
                    />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <lable>Ngày Sinh :</lable>

                  <div class="cs-form_field_wrap">
                    <input
                      type="datetime-local"
                      class="cs-form_field"
                      v-model="birthDay"
                      placeholder="Năm Sinh"
                    />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-12">
                  <lable>Nơi Sinh :</lable>
                  <div class="cs-form_field_wrap">
                 
                    <input
                      type="text"
                      class="cs-form_field"
                      v-model="street"
                      placeholder="Nơi sinh"
                    />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <lable>Ảnh Căn Cước Mặt Trước :</lable>
                  <div class="cs-form_field_wrap">
                  
                    <input id="imageUpload" type="file" @change="readURL" />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                  <div class="cs-form_field_wrap">
                    <canvas
                      id="imageCanvas"
                      style="width: 300px; height: 150px"
                    ></canvas>
                  </div>

                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <lable>Ảnh Căn Cước Mặt Sau :</lable>
                  <div class="cs-form_field_wrap">
                    

                    <input id="imageUpload" type="file" @change="readURL2" />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                  <div class="cs-form_field_wrap">
                    <canvas
                      id="imageCanvas2"
                      style="width: 300px; height: 150px"
                    ></canvas>
                  </div>

                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <lable>Ảnh Cá Nhân :</lable>
                  <div class="cs-form_field_wrap">
                  

                    <input id="imageUpload" type="file" @change="readURL3" />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                  <div class="cs-form_field_wrap">
                    <canvas
                      id="imageCanvas3"
                      style="width: 300px; height: 150px"
                    ></canvas>
                  </div>

                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <lable>Ảnh Rank-Cấp Độ-HightLight:</lable>
                  <div class="cs-form_field_wrap">
                  
                    <input id="imageUpload" type="file" @change="readURL4" />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                  <div class="cs-form_field_wrap">
                    <canvas
                      id="imageCanvas4"
                      style="width: 300px; height: 150px"
                    ></canvas>
                  </div>

                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-12">
                  <div v-for="(prediction, index) in predictions" :key="index">
                    <span
                      :style="{
                        width: '10%',
                        color: getColorForClassName(prediction.className),
                      }"
                    >
                      {{ prediction.className }}
                    </span>
                    :
                    <div class="progress mb-3" style="height: 20px">
                      <div
                        class="progress-bar progress-bar-striped progress-bar-animated"
                        :style="{
                          width: prediction.probability * 100 + '%',
                          backgroundColor: getBackgroundColorForClassName(
                            prediction.className,
                          ),
                        }"
                        :aria-valuenow="
                          (prediction.probability * 100).toFixed(2)
                        "
                        aria-valuemin="0"
                      >
                        <span class="pr-2"
                          >{{
                            (prediction.probability * 100).toFixed(2)
                          }}%</span
                        >
                      </div>
                    </div>
                  </div>
                  <div v-if="isCheckMax" class="alert alert-warning">
                    Tỉ Lệ Không Hợp Lệ Cao :{{
                      maxCheckProbability.toFixed(2)
                    }}% Vui Lòng Cập Nhập Lại Ảnh
                    <img
                      width="30"
                      height="30"
                      src="https://img.icons8.com/color/48/000000/warning-shield.png"
                      alt="warning-shield"
                    />
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="cs-form_field_wrap">
                    <textarea
                      cols="30"
                      rows="5"
                      v-model="decription"
                      placeholder="Mô Tả Chi Tiết Kỹ Năng , Kinh Nghiệm"
                      class="cs-form_field"
                    ></textarea>
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <div class="cs-form_field_wrap">
                    <input
                      type="text"
                      class="cs-form_field"
                      v-model="url_faceBook"
                      placeholder="Link FaceBook :"
                    />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>
                <div class="col-lg-6">
                  <div class="cs-form_field_wrap">
                    <input
                      type="text"
                      class="cs-form_field"
                      v-model="url_youtube"
                      placeholder="Link Youtube :"
                    />
                  </div>
                  <div class="cs-height_20 cs-height_lg_20"></div>
                </div>

                <div class="col-lg-12">
                  <button
                    class="cs-btn cs-style1 cs-btn_lg"
                    v-if="!isCheckMax"
                    :disabled="isCheckMax"
                  >
                    <span>Send Form</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="cs-height_70 cs-height_lg_40"></div>
    <!-- Start Footer -->
    <footerHome></footerHome>
    <!-- End Footer -->
  </div>
</template>

<script>
import footerHome from "@/pages/footer.vue";
import startHeader from "@/pages/startHeader.vue";
import BecomeIdolService from "@/service/BecomeIdolService";
import { userInfo } from "@/store";
import Swal from "sweetalert2";

import * as tmImage from "@teachablemachine/image";

export default {
  name: "becomeIdol",
  components: {
    footerHome,
    startHeader,
  },

  data() {
    return {
      model: null,
      predictions: [],
      isButtonCreate: false,
      becomeForm: [],
      fullName: "",
      birthDay: "",
      street: "",
      imgAfter: "",
      imgBefore: "",
      imgAvarta: "",
      imgRank: "",
      decription: "",
      url_faceBook: "",
      url_youtube: "",
    };
  },
  methods: {
    async createBecomeForm() {
      try {
        const id = userInfo.value.id;
        console.log("id" + this.id);
        if (!this.fullName || !this.birthDay || !this.street || !this.imgAfter || !this.imgBefore || !this.imgAvarta || !this.imgRank || !this.decription || !this.url_faceBook || !this.url_youtube) {
      console.log("Vui lòng điền đầy đủ thông tin");
      // Bạn có thể hiển thị thông báo lỗi cho người dùng ở đây nếu cần
      Swal.fire("Login Success!", "Vui lòng điền đầy đủ thông tin!", "warning")

    } else {
        const response = await BecomeIdolService.saveTransaction(
          this.fullName,
          this.birthDay,
          this.street,
          this.imgAfter,
          this.imgBefore,
          this.imgAvarta,
          this.imgRank,
          this.decription,
          this.url_faceBook,
          this.url_youtube,
          id,
        );
        if (response.id) {
          console.log("Create Oke");
          Swal.fire("Login Success!", "Đơn Đăng Ký Đang Được Duyệt!", "success")

        } else {
          console.log("Create Error");
        }
      }
      } catch (error) {
        console.error(error);
      }
    },
    getColorForClassName(className) {
      switch (className) {
        case "Hợp Lệ":
          return "#E67701";
        case "Không Hợp Lệ :":
          return "#e60101";

        default:
          return "black"; // Màu mặc định hoặc giá trị màu bạn muốn
      }
    },
    getBackgroundColorForClassName(className) {
      switch (className) {
        case "Hợp Lệ":
          return "#E67701";
        case "Không Hợp Lệ :":
          return "#e60101";

        default:
          return "#FFECE2"; // Màu nền mặc định hoặc giá trị màu bạn muốn
      }
    },
    async init() {
      const URL = "https://teachablemachine.withgoogle.com/models/Y9-FwPmSu/";
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      this.model = Object.freeze(await tmImage.load(modelURL, metadataURL));
    },
    async predict(canvasElement) {
      const prediction = await this.model.predict(canvasElement, false);
      this.predictions = prediction;
    },
    readURL(event) {
      this.imgBefore = event.target.files[0];
      var reader = new FileReader();
      reader.onload = function (e) {
        const imageCanvas = document.getElementById("imageCanvas");
        const context = imageCanvas.getContext("2d");
        const image = new Image();

        image.onload = function () {
          imageCanvas.width = image.width;
          imageCanvas.height = image.height;
          context.drawImage(image, 0, 0, image.width, image.height);
          this.init().then(() => {
            this.predict(imageCanvas);
          });
        }.bind(this);

        image.src = e.target.result;
      }.bind(this);
      reader.readAsDataURL(this.imgBefore);
    },
    readURL2(event) {
      this.imgAfter = event.target.files[0];

      var reader = new FileReader();
      reader.onload = function (e) {
        const imageCanvas = document.getElementById("imageCanvas2");
        const context = imageCanvas.getContext("2d");
        const image = new Image();

        image.onload = function () {
          imageCanvas.width = image.width;
          imageCanvas.height = image.height;
          context.drawImage(image, 0, 0, image.width, image.height);
          this.init().then(() => {
            this.predict(imageCanvas);
          });
        }.bind(this);

        image.src = e.target.result;
      }.bind(this);
      reader.readAsDataURL(this.imgAfter);
    },
    readURL3(event) {
      this.imgAvarta = event.target.files[0];

      var reader = new FileReader();
      reader.onload = function (e) {
        const imageCanvas = document.getElementById("imageCanvas3");
        const context = imageCanvas.getContext("2d");
        const image = new Image();

        image.onload = function () {
          imageCanvas.width = image.width;
          imageCanvas.height = image.height;
          context.drawImage(image, 0, 0, image.width, image.height);
          this.init().then(() => {
            this.predict(imageCanvas);
          });
        }.bind(this);

        image.src = e.target.result;
      }.bind(this);
      reader.readAsDataURL(this.imgAvarta);
    },
    readURL4(event) {
      this.imgRank = event.target.files[0];
      var reader = new FileReader();
      reader.onload = function (e) {
        const imageCanvas = document.getElementById("imageCanvas4");
        const context = imageCanvas.getContext("2d");
        const image = new Image();

        image.onload = function () {
          imageCanvas.width = image.width;
          imageCanvas.height = image.height;
          context.drawImage(image, 0, 0, image.width, image.height);
          this.init().then(() => {
            this.predict(imageCanvas);
          });
        }.bind(this);

        image.src = e.target.result;
      }.bind(this);
      reader.readAsDataURL(this.imgRank);
    },
  },
  computed: {
    isCheckMax() {
      // Tìm giá trị xác suất lớn nhất
      const maxProbability = Math.max(
        ...this.predictions.map((prediction) => prediction.probability),
      );
      return (
        maxProbability > 0 && // Đảm bảo có ít nhất một giá trị xác suất lớn hơn 0
        this.predictions.some(
          (prediction) =>
            prediction.className === "Không Hợp Lệ :" &&
            prediction.probability === maxProbability,
        )
      );
    },
    maxCheckProbability() {
      // Lấy giá trị xác suất lớn nhất cho "check"
      const checkPrediction = this.predictions.find(
        (prediction) => prediction.className === "Không Hợp Lệ :",
      );
      return checkPrediction ? checkPrediction.probability * 100 : 0;
    },
  },
};
</script>

<style></style>
